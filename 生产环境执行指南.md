# 生产环境执行收入明细查询脚本

## 🎯 目标
查询 2025-12-02 的所有收入明细，显示：序号 | 金额 | 订单号 | 时间

## ✅ 脚本已准备就绪
- ✅ 脚本已推送到 GitHub 仓库
- ✅ 脚本路径：`list_all_income_records.py`
- ✅ 输出格式：序号 | 金额 | 订单号 | 时间

## 🚀 执行步骤

### 步骤1：连接到生产服务器

根据你的部署方式选择：

**方式A：SSH 连接**
```bash
ssh user@your-production-server
```

**方式B：Docker 容器**
```bash
docker exec -it <container_name> bash
```

**方式C：Zeabur/其他平台**
- 使用平台提供的 SSH 或终端功能

### 步骤2：进入项目目录

```bash
cd /app
# 或者你的项目实际路径
```

### 步骤3：拉取最新代码（如果使用 Git 部署）

```bash
git pull origin main
```

### 步骤4：运行脚本

```bash
# 设置数据库路径
export DATA_DIR=/data

# 运行脚本查询 2025-12-02
python list_all_income_records.py 2025-12-02
```

### 步骤5：保存结果（可选）

```bash
python list_all_income_records.py 2025-12-02 > income_2025-12-02.txt
cat income_2025-12-02.txt
```

## 📋 完整一键命令

**SSH 连接后执行：**
```bash
cd /app && export DATA_DIR=/data && python list_all_income_records.py 2025-12-02
```

**Docker 容器直接执行：**
```bash
docker exec -it <container_name> bash -c "cd /app && export DATA_DIR=/data && python list_all_income_records.py 2025-12-02"
```

## 📊 预期输出

```
数据库路径: /data/loan_bot.db
DATA_DIR: /data
数据库文件大小: X.XX MB

====================================================================================================
2025-12-02 所有收入明细记录
====================================================================================================

总计: XX 条记录

【利息收入】XX 笔, 总计: XX,XXX.XX 元
------------------------------------------------------------------------------------------------------------------------
  序号              金额 |                       订单号 |         时间
------------------------------------------------------------------------------------------------------------------------
  1.         840.00 |              2511180307 |   14:26:50
  2.         180.00 |            2512020903A |   13:13:45
  3.         420.00 |            2512020903A |   13:11:18
  ...
```

## ⚠️ 故障排查

### 问题1：找不到脚本
```bash
# 检查脚本是否存在
ls -la list_all_income_records.py

# 如果不存在，拉取最新代码
git pull origin main
```

### 问题2：数据库路径错误
```bash
# 检查环境变量
echo $DATA_DIR

# 检查数据库文件
ls -la /data/loan_bot.db

# 手动设置路径
export DATA_DIR=/data
```

### 问题3：Python 环境问题
```bash
# 检查 Python 版本
python --version

# 检查是否在虚拟环境中
which python
```

## ✅ 验证清单

- [ ] 已连接到生产服务器
- [ ] 已进入项目目录
- [ ] 已拉取最新代码（如需要）
- [ ] 已设置 DATA_DIR 环境变量
- [ ] 数据库文件存在
- [ ] 脚本文件存在
- [ ] 运行脚本成功

## 📞 需要帮助？

如果遇到问题，检查：
1. 数据库路径是否正确
2. 脚本文件是否存在
3. Python 环境是否正常
4. 是否有读取数据库的权限

