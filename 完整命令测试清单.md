# 完整命令测试清单

## 📋 测试概览

- **测试时间**: 2024-11-27
- **测试状态**: ✅ 代码层面测试完成（100%通过）
- **待测试**: 实际运行测试（需要机器人运行）

---

## 🎯 命令分类

### 一、私聊命令（Private Chat Commands）

#### 1. 基础命令

| 序号 | 命令 | 权限 | 说明 | 测试状态 |
|------|------|------|------|----------|
| 1 | `/start` | 授权用户 | 显示帮助信息 | ✅ 代码测试通过 |
| 2 | `/report [归属ID]` | 授权用户 | 查看报表 | ✅ 代码测试通过 |
| 3 | `/myreport` | 任何用户 | 查看受限归属ID报表 | ✅ 代码测试通过 |
| 4 | `/search <类型> <值>` | 授权用户 | 查找订单 | ✅ 代码测试通过 |
| 5 | `/accounts` | 授权用户 | 查看所有支付账户 | ✅ 代码测试通过 |
| 6 | `/gcash` | 授权用户 | 查看GCASH账号 | ✅ 代码测试通过 |
| 7 | `/paymaya` | 授权用户 | 查看PayMaya账号 | ✅ 代码测试通过 |
| 8 | `/schedule` | 授权用户 | 管理定时播报 | ✅ 代码测试通过 |

---

### 二、群组命令（Group Chat Commands）

#### 2. 订单操作

| 序号 | 命令 | 权限 | 说明 | 测试状态 |
|------|------|------|------|----------|
| 9 | `/create` | 授权用户 | 读取群名创建订单 | ✅ 代码测试通过 |
| 10 | `/order` | 授权用户 | 查看当前订单 | ✅ 代码测试通过 |

#### 3. 订单状态管理

| 序号 | 命令 | 权限 | 说明 | 收入记录 | 测试状态 |
|------|------|------|------|----------|----------|
| 11 | `/normal` | 授权用户 | 设为正常状态 | ❌ | ✅ 代码测试通过 |
| 12 | `/overdue` | 授权用户 | 设为逾期状态 | ❌ | ✅ 代码测试通过 |
| 13 | `/end` | 授权用户 | 标记为完成 | ✅ 自动记录 | ✅ 代码测试通过 |
| 14 | `/breach` | 授权用户 | 标记为违约 | ❌ | ✅ 代码测试通过 |
| 15 | `/breach_end [金额]` | 授权用户 | 违约完成 | ✅ 自动记录 | ✅ 代码测试通过 |

#### 4. 播报功能

| 序号 | 命令 | 权限 | 说明 | 测试状态 |
|------|------|------|------|----------|
| 16 | `/broadcast` | 授权用户 | 播报付款提醒 | ✅ 代码测试通过 |

---

### 三、管理员命令（Admin Only）

#### 5. 资金管理

| 序号 | 命令 | 格式 | 说明 | 测试状态 |
|------|------|------|------|----------|
| 17 | `/adjust` | `/adjust <金额> [备注]` | 调整资金 | ✅ 代码测试通过 |

#### 6. 归属ID管理

| 序号 | 命令 | 格式 | 说明 | 测试状态 |
|------|------|------|------|----------|
| 18 | `/create_attribution` | `/create_attribution <ID>` | 创建归属ID | ✅ 代码测试通过 |
| 19 | `/list_attributions` | `/list_attributions` | 列出所有归属ID | ✅ 代码测试通过 |

#### 7. 员工管理

| 序号 | 命令 | 格式 | 说明 | 测试状态 |
|------|------|------|------|----------|
| 20 | `/add_employee` | `/add_employee <用户ID>` | 添加员工 | ✅ 代码测试通过 |
| 21 | `/remove_employee` | `/remove_employee <用户ID>` | 移除员工 | ✅ 代码测试通过 |
| 22 | `/list_employees` | `/list_employees` | 列出所有员工 | ✅ 代码测试通过 |

#### 8. 用户权限管理

| 序号 | 命令 | 格式 | 说明 | 测试状态 |
|------|------|------|------|----------|
| 23 | `/set_user_group_id` | `/set_user_group_id <用户ID> <归属ID>` | 设置用户归属权限 | ✅ 代码测试通过 |
| 24 | `/remove_user_group_id` | `/remove_user_group_id <用户ID>` | 移除用户归属权限 | ✅ 代码测试通过 |
| 25 | `/list_user_group_mappings` | `/list_user_group_mappings` | 列出所有用户归属映射 | ✅ 代码测试通过 |

#### 9. 系统维护

| 序号 | 命令 | 说明 | 测试状态 |
|------|------|------|----------|
| 26 | `/update_weekday_groups` | 更新星期分组 | ✅ 代码测试通过 |
| 27 | `/fix_statistics` | 修复统计数据 | ✅ 代码测试通过 |
| 28 | `/find_tail_orders` | 查找尾数订单 | ✅ 代码测试通过 |

---

### 四、快捷操作（消息格式）

#### 10. 金额操作

| 序号 | 格式 | 权限 | 说明 | 收入记录 | 测试状态 |
|------|------|------|------|----------|----------|
| 29 | `+<金额>` | 授权用户 | 利息收入 | ✅ 自动记录 | ✅ 代码测试通过 |
| 30 | `+<金额>b` | 授权用户 | 本金减少 | ✅ 自动记录 | ✅ 代码测试通过 |

**示例**:
- `+500` - 记录500利息收入
- `+1000b` - 本金减少1000

---

### 五、自动触发功能

| 序号 | 触发条件 | 说明 | 测试状态 |
|------|----------|------|----------|
| 31 | 新成员入群 | 自动解析群名创建订单 | ✅ 代码测试通过 |
| 32 | 群名变更 | 自动解析新群名创建订单 | ✅ 代码测试通过 |

---

### 六、回调按钮功能

#### 11. 报表相关回调

| 序号 | 回调 | 说明 | 权限 | 测试状态 |
|------|------|------|------|----------|
| 33 | `report_view_today` | 今日报表 | 授权用户 | ✅ 代码测试通过 |
| 34 | `report_view_month` | 月报 | 授权用户 | ✅ 代码测试通过 |
| 35 | `report_view_query` | 日期查询 | 授权用户 | ✅ 代码测试通过 |
| 36 | `income_view_today` | 今日收入明细 | **仅管理员** | ✅ 代码测试通过 |
| 37 | `income_view_month` | 本月收入明细 | **仅管理员** | ✅ 代码测试通过 |
| 38 | `income_view_query` | 收入日期查询 | **仅管理员** | ✅ 代码测试通过 |
| 39 | `income_view_by_type` | 收入分类查询 | **仅管理员** | ✅ 代码测试通过 |
| 40 | `report_record_company` | 公司开销 | 授权用户 | ✅ 代码测试通过 |
| 41 | `report_record_other` | 其他开销 | 授权用户 | ✅ 代码测试通过 |

#### 12. 搜索相关回调

| 序号 | 回调 | 说明 | 测试状态 |
|------|------|------|----------|
| 42 | `search_menu_state` | 按状态搜索 | ✅ 代码测试通过 |
| 43 | `search_menu_attribution` | 按归属搜索 | ✅ 代码测试通过 |
| 44 | `search_menu_group` | 按星期分组搜索 | ✅ 代码测试通过 |

#### 13. 订单相关回调

| 序号 | 回调 | 说明 | 测试状态 |
|------|------|------|----------|
| 45 | `order_action_*` | 订单操作 | ✅ 代码测试通过 |

#### 14. 支付账户回调

| 序号 | 回调 | 说明 | 测试状态 |
|------|------|------|----------|
| 46 | `payment_*` | 支付账户管理 | ✅ 代码测试通过 |

#### 15. 定时播报回调

| 序号 | 回调 | 说明 | 测试状态 |
|------|------|------|----------|
| 47 | `schedule_*` | 定时播报管理 | ✅ 代码测试通过 |

---

## 📊 测试统计

### 代码层面测试

- **总命令数**: 47个
- **代码测试通过**: 47个
- **代码测试失败**: 0个
- **代码测试通过率**: 100%

### 实际运行测试

- **待测试命令数**: 47个
- **已测试**: 0个
- **测试进度**: 0%

---

## 🎯 详细命令说明

### 1. `/start` - 显示帮助信息

**使用场景**: 私聊机器人
**权限要求**: 授权用户
**参数**: 无
**功能**: 显示所有可用命令的帮助信息

**测试步骤**:
1. 在私聊中发送 `/start`
2. 验证是否显示帮助信息
3. 验证帮助信息是否完整

---

### 2. `/report [归属ID]` - 查看报表

**使用场景**: 私聊机器人
**权限要求**: 授权用户
**参数**: 
- 无参数：全局报表
- 归属ID：指定归属ID的报表

**功能**: 
- 显示今日报表
- 支持查看月报
- 支持日期范围查询
- 管理员可查看收入明细

**测试步骤**:
1. 发送 `/report` 查看全局报表
2. 发送 `/report S01` 查看S01归属报表
3. 点击"📅 月报"按钮
4. 点击"📆 日期查询"按钮
5. 管理员点击"💰 收入明细"按钮

---

### 3. `/myreport` - 查看我的报表

**使用场景**: 私聊机器人
**权限要求**: 任何用户（查看受限归属ID）
**参数**: 无
**功能**: 显示用户有权限查看的归属ID报表

**测试步骤**:
1. 受限用户发送 `/myreport`
2. 验证显示该用户的归属ID报表

---

### 4. `/search <类型> <值>` - 查找订单

**使用场景**: 私聊机器人
**权限要求**: 授权用户
**参数**: 
- 类型：order_id/group_id/customer/state/date
- 值：对应类型的值

**示例**:
- `/search order_id 0001`
- `/search group_id S01`
- `/search customer A`
- `/search state end`
- `/search date 2024-01-01 2024-01-31`

**测试步骤**:
1. 按订单ID查找
2. 按归属ID查找
3. 按客户类型查找
4. 按状态查找
5. 按日期范围查找

---

### 5-7. 支付账户命令

#### `/accounts` - 查看所有账户
- 显示所有支付账户的表格

#### `/gcash` - 查看GCASH账号
- 显示GCASH账号信息和操作按钮

#### `/paymaya` - 查看PayMaya账号
- 显示PayMaya账号信息和操作按钮

---

### 8. `/schedule` - 管理定时播报

**功能**: 
- 设置定时播报（最多3个槽位）
- 编辑/删除定时播报
- 启用/禁用定时播报

---

### 9. `/create` - 创建订单

**使用场景**: 群组
**权限要求**: 授权用户
**参数**: 无（自动读取群名）

**功能**: 解析群名创建订单

**测试步骤**:
1. 在群组中发送 `/create`
2. 验证是否成功创建订单
3. 验证订单信息是否正确

---

### 10. `/order` - 查看当前订单

**使用场景**: 群组
**权限要求**: 授权用户
**功能**: 显示当前群组的订单信息

---

### 11-15. 订单状态命令

#### `/normal` - 设为正常
- 从逾期状态转为正常

#### `/overdue` - 设为逾期
- 从正常状态转为逾期

#### `/end` - 标记为完成 ⭐
- **功能**: 订单完成，自动记录收入明细
- **测试重点**: 验证收入记录是否自动创建

#### `/breach` - 标记为违约
- 从正常/逾期转为违约

#### `/breach_end [金额]` - 违约完成 ⭐
- **功能**: 违约订单完成，自动记录收入明细
- **测试重点**: 验证收入记录是否自动创建

---

### 16. `/broadcast` - 播报付款提醒

**功能**: 向当前群组播报付款提醒

---

### 17. `/adjust <金额> [备注]` - 调整资金

**使用场景**: 私聊
**权限要求**: 管理员
**功能**: 手动调整流动资金

**示例**: 
- `/adjust 1000`
- `/adjust -500 调整资金`

---

### 18-19. 归属ID管理

#### `/create_attribution <ID>`
- 创建新的归属ID

#### `/list_attributions`
- 列出所有归属ID

---

### 20-22. 员工管理

#### `/add_employee <用户ID>`
- 添加授权员工

#### `/remove_employee <用户ID>`
- 移除授权员工

#### `/list_employees`
- 列出所有授权员工

---

### 23-25. 用户权限管理

#### `/set_user_group_id <用户ID> <归属ID>`
- 设置用户只能查看指定归属ID的报表

#### `/remove_user_group_id <用户ID>`
- 移除用户的归属ID限制

#### `/list_user_group_mappings`
- 列出所有用户归属ID映射

---

### 26-28. 系统维护命令

#### `/update_weekday_groups`
- 更新所有订单的星期分组

#### `/fix_statistics`
- 修复统计数据（重新计算）

#### `/find_tail_orders`
- 查找有尾数的订单

---

### 29-30. 快捷操作

#### `+<金额>` - 利息收入 ⭐
- **功能**: 记录利息收入，自动记录收入明细
- **测试重点**: 验证收入记录是否自动创建

#### `+<金额>b` - 本金减少 ⭐
- **功能**: 本金减少，自动记录收入明细
- **测试重点**: 验证收入记录是否自动创建

---

## 🔍 收入记录测试重点

以下操作会自动记录收入明细，需要重点测试：

1. ✅ `/end` - 订单完成 → 记录 `completed` 类型收入
2. ✅ `/breach_end` - 违约完成 → 记录 `breach_end` 类型收入
3. ✅ `+金额` - 利息收入 → 记录 `interest` 类型收入
4. ✅ `+金额b` - 本金减少 → 记录 `principal_reduction` 类型收入

**验证方法**:
- 执行上述操作
- 查看报表中的"💰 收入明细"
- 验证收入记录是否自动创建
- 验证收入明细信息是否正确

---

## 📝 实际运行测试记录

### 测试环境
- **测试时间**: 
- **测试用户ID**: 
- **测试群组ID**: 

### 测试记录

#### 基础命令测试

**命令**: `/start`
- [ ] 测试时间: 
- [ ] 测试结果: 
- [ ] 备注: 

**命令**: `/report`
- [ ] 测试时间: 
- [ ] 测试结果: 
- [ ] 验证收入明细按钮显示: 
- [ ] 备注: 

#### 订单操作测试

**命令**: `/create`
- [ ] 测试时间: 
- [ ] 测试群名: 
- [ ] 测试结果: 
- [ ] 备注: 

**命令**: `/end`
- [ ] 测试时间: 
- [ ] 订单ID: 
- [ ] 订单金额: 
- [ ] 收入记录验证: 
- [ ] 备注: 

#### 金额操作测试

**操作**: `+500`
- [ ] 测试时间: 
- [ ] 金额: 
- [ ] 收入记录验证: 
- [ ] 备注: 

**操作**: `+1000b`
- [ ] 测试时间: 
- [ ] 金额: 
- [ ] 收入记录验证: 
- [ ] 备注: 

#### 收入明细查询测试

**功能**: 今日收入明细
- [ ] 测试时间: 
- [ ] 访问方式: 报表界面 → 收入明细
- [ ] 显示结果: 
- [ ] 验证: 收入记录是否正确显示
- [ ] 备注: 

---

## ✅ 测试完成标准

### 代码层面
- [x] 所有命令处理器可正常导入
- [x] 所有函数签名正确
- [x] 数据库操作正常
- [x] 回调处理器正常

### 实际运行层面
- [ ] 所有命令可正常执行
- [ ] 权限控制正确
- [ ] 返回结果符合预期
- [ ] 收入记录自动创建
- [ ] 收入明细查询正常

---

**最后更新时间**: 2024-11-27  
**代码测试状态**: ✅ 100%通过  
**实际运行测试**: ⏳ 待测试

